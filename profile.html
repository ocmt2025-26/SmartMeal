<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SmartMeal - Profile</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<header class="site-header">
    <div class="brand">
        <div class="logo-box">
            <img src="https://raw.githubusercontent.com/ocmt2025-26/SmartMeal/main/college.png.jpeg" 
                 alt="College Logo" style="width:40px; height:40px; object-fit:cover; border-radius:4px;">
        </div>
        <div>
            <h1>SmartMeal</h1>
            <p class="subtitle" id="headerUsername">Profile</p>
        </div>
    </div>
    <nav class="nav">
        <a href="index.html">Home</a>
        <a href="menu.html">Menu</a>
        <a href="cart.html">Cart (<span id="cartCount">0</span>)</a>
        <a href="profile.html" id="profileLink">Profile</a>
    </nav>
</header>

<main class="container fade-in">
    <h2>Your Profile</h2>
    <div id="profileBox"></div>

    <h2>Your Orders</h2>
    <div id="orderHistory"></div>

    <button class="btn ghost" onclick="logout()">Logout</button>
</main>

<footer class="site-footer">
    <div>Contact: cafeteria@ocmt.edu.om</div>
    <div>© SmartMeal • Terms & Conditions</div>
</footer>

<script src="app.js"></script>
<script>
window.addEventListener('DOMContentLoaded', () => {
    const user = JSON.parse(localStorage.getItem('smartmeal_user'));
    if (!user) {
        window.location.href = 'login.html';
        return;
    }

    document.getElementById('headerUsername').innerText = user.name;
    document.getElementById('profileLink').innerText = user.name;

    const profileBox = document.getElementById('profileBox');
    profileBox.innerHTML = `
        <p><strong>Name:</strong> ${user.name}</p>
        <p><strong>Email:</strong> ${user.email}</p>
        <p><strong>Phone:</strong> ${user.phone || 'N/A'}</p>
    `;

    const orderHistory = document.getElementById('orderHistory');
    const orders = JSON.parse(localStorage.getItem('smartmeal_orders')) || [];
    const userOrders = orders.filter(order => order.userEmail === user.email);

    if (userOrders.length === 0) {
        orderHistory.innerHTML = '<p>No orders yet.</p>';
    } else {
        userOrders.forEach(order => {
            const div = document.createElement('div');
            div.classList.add('order-item');
            div.innerHTML = `
                <h3>Order #${order.id} - ${order.status}</h3>
                <p>${order.items.map(i => `${i.name} x${i.quantity}`).join('<br>')}</p>
                <p><strong>Total:</strong> ${order.total.toFixed(2)} OMR</p>
                ${order.status !== 'Cancelled' ? `<button class="btn ghost" onclick="cancelOrder('${order.id}')">Cancel</button>` : ''}
            `;
            orderHistory.appendChild(div);
        });
    }
});

function logout() {
    localStorage.removeItem('smartmeal_user');
    window.location.href = 'login.html';
}

function cancelOrder(orderId) {
    let orders = JSON.parse(localStorage.getItem('smartmeal_orders')) || [];
    orders = orders.map(o => o.id === orderId ? {...o, status: 'Cancelled'} : o);
    localStorage.setItem('smartmeal_orders', JSON.stringify(orders));
    window.location.reload();
}
</script>
</body>
</html>
